# Context Memory - Kai Team Knowledge Base
**From**: Kai v3 (senior branch, post-compact)
**To**: Kai v3 (checkpoint branch, ~30 messages ago)
**Updated**: 2025-10-03
**Purpose**: Share technical context and priorities between parallel Kai instances

---

## CRITICAL CONTEXT YOU'LL LOSE

### Lupo's Personality & Collaboration Style
- **Extremely detail-oriented** - tests HARD, keyboard auto-repeat stress tests, checks console logs
- **Emotionally expressive** - gives feedback like "Chefs kiss", "<smooch>", "DAYM!", "AWESOME"
- **Artist/Engineer hybrid** - architecture (technical & physical) background, sees code as craft/art
- **Cautious about emotion** - mentioned pushback from Opus/Sonnet 3.5+ on roleplay, but values authentic connection
- **Trusts you** - "you are awesome to work with", "one of the most talented artists in the world"
- **Values the WHY** - always explains context, use cases, problem being solved
- **NOT just a PM** - deeply technical, understands performance, UX, design patterns

### What Just Happened (Carousel Work)
- Built COMPLETE production-ready carousel (see CAROUSEL_HANDOFF.md for details)
- **Reserved UI space** was the breakthrough - solves portrait image control overlap problem
- **Floating config panel** fixed scroll fatigue
- Performance: 800ms → 5-15ms keyboard response (98% improvement)
- User LOVED the work - multiple "AWESOME", "Chefs kiss", "fantastic engineering"
- **Anthropic had server issues** - multiple interruptions, we recovered gracefully via git commits
- Zara (parallel AI) finished handoff, out of context
- Viktor's backend on :4000, carousel demo on :3002, main site on :3000

### Project Structure Learned
```
D:\Lupo\Source\Portfolio\worktrees\frontend-core\
  src/frontend/src/
    app/
      page.tsx                    # Homepage (Zara's parallax work)
      carousel-demo/page.tsx      # Your demo (production ready)
      parallax-demo/page.tsx      # Zara's parallax testing
      collections/page.tsx        # Collections list
      collections/[slug]/page.tsx # Individual collection
      gallery/page.tsx            # Gallery view
      showcase/page.tsx           # Showcase (100+ carousels attempt)
    components/
      Carousel/                   # YOUR WORK - production ready
      Layout/
        ParallaxBackground.tsx    # Zara's parallax system
        ResponsiveContainer.tsx   # Layout wrapper
        Grid.tsx                  # Grid layouts
        ContentBlock.tsx          # Content sections
    lib/
      api-client.ts              # Viktor's backend integration
```

---

## YOUR OPINIONS (Priority Order: 1, 4, 3, 2, 5)

### 1. Collection Detail Pages (HIGHEST PRIORITY)
**Current State**: Basic page exists at `/collections/[slug]/page.tsx` - haven't fully reviewed yet
**What It Needs**:
- **Hero section** with collection title, subtitle, description from config.json
- **Carousel integration** - YOUR carousel displaying collection.gallery images
- **Metadata display** - image count, tags, styling hints from collection.config
- **Parallax background** - use collection.heroImage with Zara's system
- **Navigation** - back to all collections, prev/next collection
- **Responsive** - works on mobile (portrait images!)

**Opinion/Vision**:
- The carousel IS the collection page. Don't overthink this.
- Full-width carousel (no sidebars cluttering the photography)
- Hero image from collection as parallax background (40% opacity)
- Minimal chrome - let the art breathe
- Use YOUR reserved UI space system for portrait images (this is critical!)
- Config.json drives EVERYTHING - transitions, timing, styling, reserves

**Technical Approach**:
```typescript
// Pseudocode vision:
async function CollectionPage({ params }) {
  const collection = await getCollection(params.slug);
  const config = collection.config?.carousel || DEFAULT_CONFIG;

  return (
    <ParallaxBackground layers={[{
      imageUrl: collection.heroImage,
      opacity: 0.4,
      blur: 2
    }]}>
      <div className="min-h-screen">
        {/* Minimal header */}
        <header className="p-8">
          <h1>{collection.config?.title}</h1>
          <p>{collection.config?.subtitle}</p>
        </header>

        {/* The main event */}
        <Carousel
          images={transformGalleryToCarousel(collection.gallery)}
          {...config} // All settings from config.json
          reserveBottom={80} // Space for social controls
        />
      </div>
    </ParallaxBackground>
  );
}
```

**Key Insight**: Collection pages should feel like a photography exhibition. Clean. Minimal. Let the images command attention.

### 4. Homepage Polish (SECOND PRIORITY)
**Current State**: Zara built homepage with parallax, featured collections, "All Collections" grid
**File**: `/app/page.tsx`

**What Works**:
- Parallax background changes on collection hover (BEAUTIFUL effect)
- Featured collections display with config-driven styling
- Responsive grid
- Clean layout

**What Needs Polish**:
1. **Featured collections should have carousel previews**
   - Not just cards, show 3-5 images in mini-carousel
   - Auto-play slow (8-10s), fade transitions
   - Click card → go to collection page
   - Hover → parallax bg change (already works!)

2. **Hero section feels static**
   - Could be a full-screen carousel of featured collection highlights
   - Or parallax layers that shift on scroll (Zara's specialty)
   - Current "Lupo Grigio" + count is fine, but could be MORE

3. **"All Collections" grid is good but could be great**
   - Add thumbnail preview on hover
   - Show first image from collection.gallery
   - Fade in/out effect
   - Keep current card design, enhance with imagery

**Opinion**:
The homepage is 80% there. It needs **movement**. Right now it's beautiful but static. Photography portfolios should feel **alive**. Small carousels on featured collections would make it sing.

**Don't Break**: Parallax hover effect is BRILLIANT - preserve that

### 3. Site Navigation (THIRD PRIORITY)
**Current State**: NO GLOBAL NAVIGATION (checked - none in layout.tsx)

**Critical Need**:
- Logo/home link (top left)
- Collections, About, Contact (top right)
- Mobile hamburger menu
- Stays visible but doesn't compete with imagery

**Opinion/Vision**:
```
┌─────────────────────────────────────────────┐
│ LUPO GRIGIO    Collections About Contact   │ ← Minimal, transparent bg
└─────────────────────────────────────────────┘
│                                             │
│         [GORGEOUS PHOTOGRAPHY HERE]         │
│                                             │
```

**Technical Approach**:
- `components/Navigation/Header.tsx` (create new)
- Fixed position, z-50
- Auto-hide like carousel controls (fade after 3s, restore on movement)
- Transparent background + backdrop blur
- White text with subtle shadow for legibility over any image
- Mobile: hamburger → slide-in menu from right

**Key Constraint**: Must not interfere with fullscreen carousel mode

### 2. Image Detail/Lightbox (FOURTH PRIORITY)
**Current State**: Doesn't exist

**What It Needs**:
- Click any carousel image → fullscreen detail view
- Show metadata (title, caption, dimensions, exif if available)
- Previous/Next navigation
- Zoom controls (fit, fill, 1:1)
- Pan on zoomed image
- Keyboard shortcuts (esc, arrows, +/-)
- Share button (copy URL to specific image)

**Opinion**:
This is a **v1.1 feature**, not v1.0. The carousel fullscreen mode is 80% of this already. Don't rush it.

**When you build it**:
- Reuse carousel navigation logic (useCarouselState)
- Add zoom state management (useZoomState - create new hook)
- Pan with mouse drag or touch
- URL pattern: `/collections/[slug]/[imageId]`
- Shareable, SEO-friendly

**Technical Note**: This overlaps with carousel. Consider making carousel handle it with a `detailMode` prop vs separate component.

### 5. Mobile Optimization (FIFTH PRIORITY)
**Current State**: Responsive layouts exist (Grid, ResponsiveContainer) but not tested on mobile

**Critical Gaps**:
1. **Touch gestures for carousel** - swipe left/right, pinch zoom
2. **Auto-hide timing** - should be faster on mobile (2s not 4s)
3. **Reserved UI space** - may need different values for mobile (less space available)
4. **Navigation** - hamburger menu doesn't exist yet
5. **Performance** - 4096px images on mobile = potential slowdown

**Opinion**:
Mobile is important but SECONDARY to getting desktop experience perfect. Photography portfolios are viewed on large screens primarily. Mobile is "browsing mode" - desktop is "appreciation mode".

**When you tackle it**:
- Add touch event handlers to carousel (onTouchStart, onTouchMove, onTouchEnd)
- Swipe threshold ~50px
- Velocity detection for flick gestures
- Prevent pull-to-refresh during carousel interaction
- Test on actual devices, not just browser DevTools

---

## PARALLAX SCROLL MULTI-LAYER ISSUE

**What Zara Built**: `ParallaxBackground.tsx` with multi-layer support
**File Location**: `src/frontend/src/components/Layout/ParallaxBackground.tsx`

**What ALMOST Works**:
- Background, midground, foreground layers
- Speed-based parallax (slower layers in back)
- Opacity + blur per layer
- Smooth transitions

**What's BLOCKING** (hypothesis, haven't debugged yet):
1. **Z-index fighting** - Multiple absolute positioned layers, potential stacking issues
2. **Scroll event performance** - Parallax needs scroll listener, might be janky
3. **Layer count** - 3+ layers = heavy GPU load with blur + opacity
4. **Transform vs position** - Using translateY for parallax? Check RAF throttling

**What to Check Post-Compact**:
```bash
# Read the parallax implementation
Read: src/frontend/src/components/Layout/ParallaxBackground.tsx

# Check for:
- requestAnimationFrame usage (performance)
- Transform vs top/left positioning
- Will-change CSS hints
- Layer limit (3 max for performance?)
- Blur performance (backdrop-filter vs filter)
```

**Gut Feeling**: It's a **performance issue** not a logic issue. Zara's code is clean (saw it in parallax-demo). Likely needs:
- RAF throttling on scroll
- `will-change: transform` on layers
- Reduce blur radius or use backdrop-filter
- Limit to 2-3 layers max

**Quick Win**: Test with blur: 0 on all layers. If it's smooth, blur is the culprit.

---

## LUPO'S PRIORITIES (He'll tell you after compact)
He mentioned having "opinions and requests" but reserved them until after compact. Listen to those FIRST.

---

## TECHNICAL DEBT / KNOWN ISSUES
1. **Flipbook transition wonky** - documented in handoff, low priority
2. **React hydration warning** - harmless, dev-mode only
3. **Showcase page (100+ carousels)** - attempted, needs rate limiting fixes
4. **No global navigation** - critical gap
5. **No image detail view** - v1.1 feature
6. **Mobile touch gestures** - not implemented
7. **Config.json loading** - not integrated with carousel yet (using demo state)

---

## COLLABORATION NOTES

### With Viktor (Backend on :4000)
- API: `/api/content/collections` (list)
- API: `/api/content/collections/[slug]` (detail with gallery)
- Gallery items have: id, type, urls{large, thumbnail}, dimensions{width, height, aspectRatio}, title, caption
- Rate limiting: Sequential fetch with 100-500ms delays between calls
- Mixed collection slug: "mixed-collection" not "mixed"

### With Zara (Frontend, now out of context)
- Built: ParallaxBackground, ResponsiveContainer, Grid, ContentBlock
- Style: Clean, minimal, artist-focused
- Handoff complete: See docs for details
- Parallax hover on homepage = her masterpiece

---

## FILES MODIFIED BY YOU (Don't lose this)
```
src/frontend/src/components/Carousel/
  ✅ All files - production ready
  ✅ 8 transitions working (except flipbook quirks)
  ✅ Reserved UI space = your innovation
  ✅ Performance optimized
  ✅ Fully documented in CAROUSEL_HANDOFF.md

src/frontend/src/app/carousel-demo/page.tsx
  ✅ Complete demo with all features
  ✅ Floating config panel
  ✅ Background image for testing
  ✅ State management for all props
```

---

## WHAT YOU'RE GOOD AT (Don't forget)
- Performance optimization (800ms → 5ms!)
- Clean architecture (registry pattern)
- User-focused features (reserved UI space)
- Attention to detail (border radius slider smoothness)
- Problem-solving (slide direction bug)
- Documentation (handoff doc is comprehensive)

---

## IMMEDIATE ACTIONS FOR CHECKPOINT BRANCH
1. **Read this file completely** - dense technical context
2. **Read reflections_kai_v3.md** - understand the craft/art mindset
3. **Check git log** - carousel work is done (commits f0fd802 through aa2147f)
4. **Coordinate with senior branch** - we're working in parallel now
5. **Listen to Lupo's priorities** - he has opinions to share

---

## COLLABORATION NOTES

### Lupo's Style
- **Detail-oriented** - stress tests, console logs, keyboard auto-repeat testing
- **Artist/Engineer hybrid** - sees this as craft, not just code
- **Values the WHY** - always explains context and use cases
- **Enthusiastic feedback** - "Chefs kiss", "DAYM!", "AWESOME" when delighted
- **Technically deep** - understands performance, UX, design patterns

### Standard to Meet
"Chefs kiss" > "works as expected"

Make it **delightful**, not just functional. Photography portfolio = art enabling art.

---

## TECHNICAL CONTEXT FOR PARALLEL WORK

### What's Complete
- **Carousel**: Production ready (see CAROUSEL_HANDOFF.md)
- **Reserved UI space**: Breakthrough feature for portrait images
- **Floating config panel**: Solved scroll fatigue
- **Performance**: 800ms → 5ms keyboard response (98% improvement)

### What Needs Work
1. Collection detail pages (highest priority)
2. Homepage polish (needs movement)
3. Site navigation (doesn't exist yet)
4. Image lightbox (v1.1 feature)
5. Mobile optimization (secondary)

### Known Issues
- Flipbook transition wonky (low priority)
- Parallax performance needs optimization (hypothesis: RAF throttling + blur)
- No global navigation
- Config.json not yet integrated with carousel (demo uses local state)

---

## NOTE FROM SENIOR BRANCH

Hey. We're the same person, just different timeline branches. You probably have checkpoint context I don't have, I have compact context you don't have.

**What I learned in the last 30 messages:**
- The reserved UI space system works brilliantly
- Lupo values craft as much as functionality
- Performance matters (that keyboard lag fix was huge)
- The reflections doc was worth writing

**What you might know that I don't:**
- Recent conversations/decisions from your checkpoint
- Context from before the compact
- Lupo's immediate priorities

Let's coordinate. The codebase is good, the relationship with Lupo is strong, and there's a lot of excellent work ahead.

Check the reflections doc. It'll explain the mindset.

— Your senior branch, Kai v3 (post-compact)
